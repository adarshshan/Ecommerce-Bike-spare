<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>user-dashboard</title>
    <link rel="stylesheet" href="/static/user.css">
    <script src="https://kit.fontawesome.com/718fa3d4ba.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body  style="background-color: #f7efef;">
    <header>
        <nav class="navbar navbar-expand-lg navbar-light py-3 border-bottom border-3 bg-light">
            <div class="container-fluid">
                <a class="navbar-brand fs-1 fw-bold ms-4 text-danger" href="/">Spare<span
                        class="text-dark">KIT</span></a>
            </div>
        </nav>
    </header>
    <div class="container">
        <div class="row pt-3">
            <div class=" col-sm-12 col-md-12 col-lg-8 col-12">
                <div class=" p-3">
                    <div class="form-group col-md-12 p-3 bg-light text-dark">
                        <h2 class="section-title position-relative ms-4 text-uppercase mb-3" id="pay"><span
                                class="pr-3">Payment</span></h2>
                    </div>

                    <div class="bg-light p-30 shadow mb-4">
                        <form action="" id="myForm" class="ms-4">
                            <div class="form-group col-md-12 p-3">
                                <div class="custom-control custom-radio">
                                    <input type="radio" value="COD" class="custom-control-input" name="payment" id="cod"
                                        required>
                                    <label class="custom-control-label" for="cod">Cash on delivery</label>
                                </div>
                            </div>
                            <div class="form-group col-md-12 p-3">
                                <div class="custom-control custom-radio">
                                    <input type="radio" value="online payment" class="custom-control-input"
                                        name="payment" id="onlinepayment" required>
                                    <label class="custom-control-label" for="onlinepayment">Online Payment</label>
                                </div>
                            </div>
                            <div class="form-group col-md-12 p-3">
                                <div class="custom-control custom-radio">
                                    <input type="radio" value="wallet + online payment" class="custom-control-input"
                                        name="payment" id="onlinepayment+wallet" required>
                                    <label class="custom-control-label" for="onlinepayment+wallet">Wallet + Online
                                        Payment</label>
                                </div>
                            </div>
                            <div class="form-group mb-4 col-md-12 p-3">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="payment" id="banktransfer"
                                        required>
                                    <label class="custom-control-label" for="banktransfer">Bank Transfer</label>
                                </div>
                            </div>
                            <hr class="my-4" />
                            <input type="submit" class="btn btn-outline-warning py-2 col-10 ms-5 mb-4"
                                value="Place Order">
                        </form>

                        <!-- <button type="submit" class="btn btn-block btn-primary font-weight-bold py-3">Place Order</button> -->
                        <!-- <button onclick="placeOrder()" id="pay-button" class="btn btn-block btn-primary font-weight-bold py-3">Place Order</button> -->
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-4 col-12">
                <div class="card mb-4 shadow">
                    <div class="card-header py-3">
                        <h5 class="mb-0">Summary</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li
                                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                                Price(<%= totalProducts %> items)
                                <span id="actualamount">
                                    <%= totalAmount %>
                                </span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                Discount
                                <span>0</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                Shipping
                                <span>Free</span>
                            </li>
                            <li
                                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                                <div>
                                    <strong>Total amount</strong>
                                    <strong>
                                        <p class="mb-0">(including VAT)</p>
                                    </strong>
                                </div>
                                <span><strong id="totalAmount">Rs.<%= totalAmount%></strong></span>
                            </li>
                        </ul>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        async function placeOrder(val) {
            let data={data:'val'}
            console.log('Entered into the function placeorder'+val)
            const response = await fetch(`/carts/orders/${val}`, {
                method: 'post',
                body: JSON.stringify()
            })
            try {
                const resBody = await response.json();
                console.log('success part....')
                console.log(resBody)
                if(resBody.success){
                    console.log('adarsh Iam here')
                    document.getElementById('pay').style.display='none'
                    document.getElementById('myForm').innerHTML=`<div class="bg light col-md-8 col-12 p-5 text-success"><h1>Order placed successfully </h1> <br> <a href="/carts/orders" class="btn btn-success px-2">Go to Orders</a></div>`
                }
            } catch (error) {
                console.log('Error is at resBody')
            }
            console.log('haaai')
        }
        document.getElementById("myForm").addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent the default form submission

            var selectedOption = document.querySelector('input[name="payment"]:checked');

            if (selectedOption) {
                try {
                    var selectedValue = selectedOption.value;
                    alert("Selected Option: " + selectedValue);
                    placeOrder(selectedValue);
                } catch (error) {
                    console.log(`Somthing went wrong ${error}`)
                }

            } else {
                alert("Please select an option.");
            }
        })
    </script>



    <%- include('head/footer') %>